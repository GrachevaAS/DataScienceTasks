### `[multi-write]` Атомарная запись в $`n`$ ячеек

Рассмотрим операцию `Multi-Write`$`(r_1, v_1, r_2, v_2, ..., r_n, v_n)`$, которая атомарно записывает значения $`v_1, v_2, ..., v_n`$ в ячейки $`r_1, r_2, ..., r_n`$ соответственно. 

1. Покажите, что `Multi-Write` в две ячейки памяти позволяет решить консенсус для двух потоков.

2. Докажите, что `Multi-Write` в $`n`$ ячеек памяти вместе с обычными точечными чтениями/записями позволяет решить консенсус по крайней мере для $`n`$ потоков.

---

Будем сразу доказывать для  $`n`$ - число потоков.

Пронумеруем потоки чисами от 1 до n. Разобьем потоки на пары. Допустим есть $`\frac{n(n+1)}{2} + 1`$ ячеек памяти, инициализированных 0, n для каждого из потоков и $`\binom {n}{2}`$ ячеек для пар потоков.

Вызывая `decide`, поток с номером $`x`$ записывает в n ячеек памяти (в одну свою и во все ячейки пар, содержащих $`x`$) свой номер. Если до этого в каждой ячейке для пар стоял 0, то текущий поток победил. Иначе все встреченные значения в ячейках пар становятся претендентами на выигрыш. Посмотрим  на значения ячеек всевозможных пар претендентов, отсеим все встреченные значения. 

Утверждается, что останется единственное номер первого потока. Без ограничения общности претендентов - $`k`$ и потоки выполнялись в порядке 1, 2, ..., $`k`$. Тогда в ячейках пар (1, 2), (1, 3), ..., (1, $`k`$) значение 1 будет перезаписано соответственно на 2, 3, ..., $`k`$. Ячейки других пар не могут содержать 1. То есть после просмотра всевозможных пар претендентов и отсеивания встреченных значений останется 1.

Тогда любой приходящий поток сможет узнать поток, который пришел раньше всех, то есть победителя.

То есть операция `Multi-Write`$`(r_1, v_1, r_2, v_2, ..., r_n, v_n)`$ позволяет решить задачу по крайней мере для $`n`$ потоков.

Decide будет возвращать всем потокам значение первого пришедшего потока, то есть `Agreement` и `Validity` выполняются.

Так как в реализации нет циклов, то `Wait-Free Termination` также выполняется.

